<app-header title="Add Purchase"></app-header>

<ion-content>
  <img *ngIf="imageVisible" src="assets/images/purchase.jpg" alt="Add Stock" />
  <h2>Add Purchase</h2>
  <ion-slides
    [options]="sliderOptions"
    #mySlider
  >
    <ion-slide>
      <form [formGroup]="addPurchaseForm" (ngSubmit)="addPurchase()">
        <ion-item>
          <ion-label position="floating">
            Seller Name
            <ion-text color="danger">*</ion-text>
          </ion-label>
          <ion-input
            required
            formControlName="name"
            placeholder="Seller Name"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Phone Number</ion-label>
          <ion-input
            type="tel"
            formControlName="phoneNumber"
            placeholder="Phone Number"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Seller Address</ion-label>
          <ion-textarea
            type="text"
            formControlName="address"
            placeholder="Address"
          ></ion-textarea>
        </ion-item>
        <ion-item>
          <ion-label>Warehouse</ion-label>
          <ion-select
            multiple="false"
            formControlName="warehouse"
            placeholder="Select Warehouse"
          >
            <ion-select-option
              [value]="warehouse"
              *ngFor="let warehouse of warehouses"
              >{{warehouse.name}}</ion-select-option
            >
          </ion-select>
        </ion-item>
        <ion-button type="submit" expand="block" fill="solid">
          Next
        </ion-button>
      </form>
    </ion-slide>
    <ion-slide>
      <ion-list>
        <ion-item>
          <ion-label>Items</ion-label>
          <ion-button slot="end" (click)="addField()">
            <ion-icon name="add-circle-outline"></ion-icon>Add Field
          </ion-button>
        </ion-item>
        <ion-card
          *ngFor="let field of fields"
          class="justify-content-between align-items-center px-2"
        >
          <ion-select
            class="w-100"
            multiple="false"
            [formControl]="field.model"
            [disabled]="field.disabled"
            interface="action-sheet"
            placeholder="Select Model"
            (ionChange)="getMatchingItems(field)"
          >
            <ion-select-option *ngFor="let modal of modals" [value]="modal">
              {{modal.name}}
            </ion-select-option>
          </ion-select>
          <ion-card *ngFor="let item of field.matchingItems">
            <ion-item >
              <ion-label>{{item.name}}</ion-label>
              <ion-icon slot="end" name="add" (click)="addItem(item,field)">
              </ion-icon>
              <ion-label slot="end">{{item.quantity}}</ion-label>
              <ion-icon slot="end" name="remove" (click)="removeItem(item,field)">
              </ion-icon>
            </ion-item>
            <ion-chip color="primary" mode="ios" *ngFor="let value of item.printables" outline="true">
              <ion-label>{{value}}:{{item[value]}}</ion-label>
            </ion-chip>
          </ion-card>
        </ion-card>
      </ion-list>
      <ion-button
        (click)="finalizePurchase()"
        expand="block"
        fill="solid"
        shape=""
      >
        Finalize Purchase
      </ion-button>
    </ion-slide>
    <ion-slide>
      <img src="assets/images/purchaseComplete.jpg" alt="" />
      <ion-button routerLink="../root/homepage">
        Back to Home <ion-icon slot="end" name="home"></ion-icon>
      </ion-button>
    </ion-slide>
  </ion-slides>
</ion-content>
